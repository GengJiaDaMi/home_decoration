SELECT s.id,s.name,s.logo_image,s.short,a.distance, (6378.138 * 2 * asin(sqrt(pow(sin((a.latitude * pi() / 180 - 39.906601 * pi() / 180) / 2),2) + cos(a.latitude * pi() / 180) * cos(39.906601 * pi() / 180) * pow(sin((a.longitude * pi() / 180 - 116.476493 * pi() / 180) / 2),2))) * 1000) as distance,a.delivery,a.hours_start,a.hours_end,a.base_price FROM `mini_shop` `s` LEFT JOIN `mini_shop_address` `a` ON `s`.`id`=`a`.`shop_id` WHERE  `s`.`status` = '1'  AND `s`.`deletetime` IS NULL  AND (  (6378.138 * 2 * asin(sqrt(pow(sin((a.latitude * pi() / 180 - 39.906601 * pi() / 180) / 2),2) + cos(a.latitude * pi() / 180) * cos(39.906601 * pi() / 180) * pow(sin((a.longitude * pi() / 180 - 116.476493 * pi() / 180) / 2),2))) * 1000)< 100000000 )  AND (  a.distance*1000 >(6378.138 * 2 * asin(sqrt(pow(sin((a.latitude * pi() / 180 - 39.906601 * pi() / 180) / 2),2) + cos(a.latitude * pi() / 180) * cos(39.906601 * pi() / 180) * pow(sin((a.longitude * pi() / 180 - 116.476493 * pi() / 180) / 2),2))) * 1000) ) ORDER BY `s`.`weigh` DESC,`distance` ASC LIMIT 0,10